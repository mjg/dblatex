%%
%% Gestion de la taille des colonnes d'un tableau.
%% Dans le principe on deux types de colonnes :
%% - des colonnes de tailles fixes, dont on veux connaitre le nombre
%%   ainsi que la taille consommée
%% - des colonnes de taille proportionnelle à la place qui reste (après le
%%   retrait de la taille fixe totale), dont on veut connaître le nombre.

\usepackage{longtable}
\usepackage{lscape}
\usepackage{colortbl}
\usepackage{multirow}
\usepackage{calc}

% Temporary latex/3797 bug fix (colortbl) by Morten Hoegholm
\expandafter\renewcommand\expandafter\multicolumn
  \expandafter[\expandafter3\expandafter]\expandafter{%
  \multicolumn{#1}{#2}{#3}}

% For the newtbl code
\newdimen\newtblstarfactor%
\newdimen\newtblsparewidth%
\newdimen\newtblcolwidth%

\newdimen\colwidth
\newdimen\mcellsz
\newdimen\cellsz
\newcounter{colnb}

% Margin cell size
\setlength{\mcellsz}{4mm}

% Méthode pour redimensionner les colonnes d'un tableau
% #1 : nombre de colonnes proportionnelles (incluant les virtuelles). Ne doit
%      pas etre nul.
% #2 : nombre de colonnes fixes
% #3 : taille cumulée des colonnes fixes

\def\resizetable#1#2#3#4{ %
  \ifthenelse{\equal{#4}{land}}{%
    \setlength{\colwidth}{\textheight-#3}%
  }{%
    \setlength{\colwidth}{\textwidth-#3}%
  }%
  \setlength{\colwidth}{\colwidth-#2\mcellsz}%
  \setcounter{colnb}{#1}%
  \divide\colwidth\value{colnb}%
}

% La taille de la colonne est un multiple de la granularité complète
% moins la marge à prendre (4mm)
\def\tsize#1{ #1\colwidth-\mcellsz }

% raccourci pour utiliser multirow, qui marche avec tsize
\def\mrow#1#2#3{ %
  \setlength{\cellsz}{#2}%
  \multirow{#1}{\cellsz}{#3}%
}
